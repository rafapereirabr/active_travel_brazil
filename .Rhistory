plot2b + theme(legend.position="none"), ncol = 2),
plot2c + theme(legend.position="none"), ncol = 1)
# add the legend on top of plot the row we made earlier. Give it 11% of the height of the plot
fig2 <- plot_grid( legend_1a, fig2, ncol = 1, rel_heights = c(.05, 1))
# save plot
ggsave(fig2, file="./plots/fig2a.png", dpi = 800,
width = 42, height = 22, units = "cm")
# save plot
ggsave(fig2, file="./plots/fig2.png", dpi = 800,
width = 42, height = 22, units = "cm")
fig2 <-   plot_grid( arrangeGrob(plot2a + theme(legend.position="none"),
plot2b + theme(legend.position="none"), ncol = 2),
plot2c + theme(legend.position="none"), ncol = 1,
align = 'vh',
hjust = -1,
)
fig2 <-   plot_grid( arrangeGrob(plot2a + theme(legend.position="none"),
plot2b + theme(legend.position="none"), ncol = 2),
plot2c + theme(legend.position="none"), ncol = 1,
align = 'vh',
hjust = -1
)
fig2
plot2c
plot2a <-
ggplot(data=subset(tab2, var %in% c("Total", "Urban")) ) +
geom_point( aes(x=as.factor(year), y=Proportion, color=quintileBR, fill=quintileBR), size=3, shape=21 ) +
geom_errorbar( aes(x=as.factor(year), y=Proportion, ymin=ci_u, ymax=ci_l, color=quintileBR),  size=0.5, width = 0) +
facet_grid( .~var+value , scales = "free_x", space="free", labeller = label_bquote(cols = .(value) ))  +
baseplot +
scale_colour_grey( start = 0, end = 0.8, guide = guide_legend(title = NULL)) +
scale_fill_grey( start = 0, end = 0.8, guide = guide_legend(title = NULL)) +
# colored chart
# scale_colour_brewer(palette = "Greys") + scale_fill_brewer(palette = "Greys")
# scale_fill_viridis(discrete=T) +  scale_color_viridis(discrete=T)
# scale_fill_manual(values = wes_palette("Royal1"), guide = guide_legend(title = NULL)) +
# scale_color_manual(values = wes_palette("Royal1"), guide = guide_legend(title = NULL)) +
scale_y_continuous(labels = scales::percent, limits=c(0,1)) +
theme(axis.title.x  = element_blank()) +
theme(legend.position = "top") +
theme(plot.margin = unit(c(1,1,2,1), "cm"))
plot2b <-
ggplot(data=subset(tab2, var %in% c("Region")) ) +
geom_point( aes(x=as.factor(year), y=Proportion, color=quintileBR, fill=quintileBR), size=3, shape=21 ) +
geom_errorbar( aes(x=as.factor(year), y=Proportion, ymin=ci_u, ymax=ci_l, color=quintileBR),  size=0.5, width = 0) +
facet_grid( .~var+value , scales = "free_y", space="free", labeller = label_bquote(cols = .(value) ))  +
baseplot +
scale_colour_grey( start = 0, end = 0.8, guide = guide_legend(title = NULL)) +
scale_fill_grey( start = 0, end = 0.8, guide = guide_legend(title = NULL)) +
scale_y_continuous(labels = scales::percent, limits=c(0,1)) +
theme(axis.title.x  = element_blank()) +
theme(axis.title.y  = element_blank()) +
theme(legend.position = "top") +
theme(plot.margin = unit(c(1,1,2,1), "cm"))
plot2c <-
ggplot(data=subset(tab2, var %in% c("Metropolitan Area")) ) +
geom_point( aes(x=as.factor(year), y=Proportion, color=quintileBR, fill=quintileBR), size=3, shape=21 ) +
geom_errorbar( aes(x=as.factor(year), y=Proportion, ymin=ci_u, ymax=ci_l, color=quintileBR),  size=0.5, width = 0) +
facet_grid( .~var+value , scales = "free_y", space="free", labeller = label_bquote(cols = .(value) ))  +
baseplot +
scale_colour_grey( start = 0, end = 0.8, guide = guide_legend(title = NULL)) +
scale_fill_grey( start = 0, end = 0.8, guide = guide_legend(title = NULL)) +
scale_y_continuous(labels = scales::percent, limits=c(0,1)) +
theme(axis.title.x  = element_blank()) +
theme(legend.position = "top") +
theme(plot.margin = unit(c(1,1,2,1), "cm")) +
theme(legend.position="none")
plot2c
ggdraw(plot2c) +
draw_plot_label("C", size = 14) +
draw_label("Metropolitan Area",  x = 0.5, y = .075,
size = 14, fontface = 'bold', hjust = -1)
ggdraw(plot2c) +
draw_plot_label("C", size = 14) +
draw_label("Metropolitan Area",  x = 0.5, y = .075,
size = 14, fontface = 'bold')
gdraw(plot2c) +
draw_plot_label("C", size = 14) +
draw_label("Metropolitan Area",  x = 0.5, y = .075,
size = 14, fontface = 'bold', align = 'vh')
ggdraw(plot2c) +
draw_plot_label("C", size = 14) +
draw_label("Metropolitan Area",  x = 0.5, y = .075,
size = 14, fontface = 'bold', align = 'vh')
ggdraw(plot2c) +
draw_plot_label("C", size = 14) +
draw_label("Metropolitan Area",  x = 0.5, y = .075,
size = 14, fontface = 'bold', align = 'vh', hjust = -1)
ggdraw(plot2c) +
draw_plot_label("C", size = 14) +
draw_label("Metropolitan Area",  x = 0.5, y = .075,
size = 14, fontface = 'bold', hjust = -5)
ggdraw(plot2c) +
draw_plot_label("C", size = 14) +
draw_label("Metropolitan Area",  x = 0.5, y = .075,
size = 14, fontface = 'bold', hjust = 5)
gdraw(plot2c) +
draw_plot_label("C", size = 14, hjust = 5) +
draw_label("Metropolitan Area",  x = 0.5, y = .075,
size = 14, fontface = 'bold')
ggdraw(plot2c) +
draw_plot_label("C", size = 14, hjust = 5) +
draw_label("Metropolitan Area",  x = 0.5, y = .075,
size = 14, fontface = 'bold')
ggdraw(plot2c) +
draw_plot_label("C", size = 14, hjust = 1) +
draw_label("Metropolitan Area",  x = 0.5, y = .075,
size = 14, fontface = 'bold')
ggdraw(plot2c) +
draw_plot_label("C", size = 14, hjust = -1) +
draw_label("Metropolitan Area",  x = 0.5, y = .075,
size = 14, fontface = 'bold')
ggdraw(plot2c) +
draw_plot_label("C", size = 14, hjust = 0) +
draw_label("Metropolitan Area",  x = 0.5, y = .075,
size = 14, fontface = 'bold')
ggdraw(plot2c) +
draw_plot_label("C", size = 14, hjust = -2) +
draw_label("Metropolitan Area",  x = 0.5, y = .075,
size = 14, fontface = 'bold')
ggdraw(plot2c) +
draw_plot_label("C", size = 14, hjust = -5) +
draw_label("Metropolitan Area",  x = 0.5, y = .075,
size = 14, fontface = 'bold')
ggdraw(plot2c) +
draw_plot_label("C", size = 14, hjust = -4) +
draw_label("Metropolitan Area",  x = 0.5, y = .075,
size = 14, fontface = 'bold')
plot2a <-
ggplot(data=subset(tab2, var %in% c("Total", "Urban")) ) +
geom_point( aes(x=as.factor(year), y=Proportion, color=quintileBR, fill=quintileBR), size=3, shape=21 ) +
geom_errorbar( aes(x=as.factor(year), y=Proportion, ymin=ci_u, ymax=ci_l, color=quintileBR),  size=0.5, width = 0) +
facet_grid( .~var+value , scales = "free_x", space="free", labeller = label_bquote(cols = .(value) ))  +
baseplot +
scale_colour_grey( start = 0, end = 0.8, guide = guide_legend(title = NULL)) +
scale_fill_grey( start = 0, end = 0.8, guide = guide_legend(title = NULL)) +
# colored chart
# scale_colour_brewer(palette = "Greys") + scale_fill_brewer(palette = "Greys")
# scale_fill_viridis(discrete=T) +  scale_color_viridis(discrete=T)
# scale_fill_manual(values = wes_palette("Royal1"), guide = guide_legend(title = NULL)) +
# scale_color_manual(values = wes_palette("Royal1"), guide = guide_legend(title = NULL)) +
scale_y_continuous(labels = scales::percent, limits=c(0,1)) +
theme(axis.title.x  = element_blank()) +
theme(legend.position = "top") +
theme(plot.margin = unit(c(1,1,2,1), "cm"))
plot2b <-
ggplot(data=subset(tab2, var %in% c("Region")) ) +
geom_point( aes(x=as.factor(year), y=Proportion, color=quintileBR, fill=quintileBR), size=3, shape=21 ) +
geom_errorbar( aes(x=as.factor(year), y=Proportion, ymin=ci_u, ymax=ci_l, color=quintileBR),  size=0.5, width = 0) +
facet_grid( .~var+value , scales = "free_y", space="free", labeller = label_bquote(cols = .(value) ))  +
baseplot +
scale_colour_grey( start = 0, end = 0.8, guide = guide_legend(title = NULL)) +
scale_fill_grey( start = 0, end = 0.8, guide = guide_legend(title = NULL)) +
scale_y_continuous(labels = scales::percent, limits=c(0,1)) +
theme(axis.title.x  = element_blank()) +
theme(axis.title.y  = element_blank()) +
theme(legend.position = "top") +
theme(plot.margin = unit(c(1,1,2,1), "cm"))
plot2c <-
ggplot(data=subset(tab2, var %in% c("Metropolitan Area")) ) +
geom_point( aes(x=as.factor(year), y=Proportion, color=quintileBR, fill=quintileBR), size=3, shape=21 ) +
geom_errorbar( aes(x=as.factor(year), y=Proportion, ymin=ci_u, ymax=ci_l, color=quintileBR),  size=0.5, width = 0) +
facet_grid( .~var+value , scales = "free_y", space="free", labeller = label_bquote(cols = .(value) ))  +
baseplot +
scale_colour_grey( start = 0, end = 0.8, guide = guide_legend(title = NULL)) +
scale_fill_grey( start = 0, end = 0.8, guide = guide_legend(title = NULL)) +
scale_y_continuous(labels = scales::percent, limits=c(0,1)) +
theme(axis.title.x  = element_blank()) +
theme(legend.position = "top") +
theme(plot.margin = unit(c(1,1,2,1), "cm")) +
theme(legend.position="none")
plot2a <- ggdraw(plot2a) +
draw_plot_label("A", size = 14, hjust = -4) +
draw_label("Country",  x = 0.5, y = .075,
size = 14, fontface = 'bold')
plot2b <- ggdraw(plot2b) +
draw_plot_label("B", size = 14, hjust = -4) +
draw_label("Region",  x = 0.5, y = .075,
size = 14, fontface = 'bold')
plot2c <- ggdraw(plot2c) +
draw_plot_label("C", size = 14, hjust = -4) +
draw_label("Metropolitan Area",  x = 0.5, y = .075,
size = 14, fontface = 'bold')
# Arrange sub-plots
fig2 <-   plot_grid( arrangeGrob(plot2a + theme(legend.position="none"),
plot2b + theme(legend.position="none"), ncol = 2),
plot2c + theme(legend.position="none"), ncol = 1)
# add the legend on top of plot the row we made earlier. Give it 11% of the height of the plot
fig2 <- plot_grid( legend_1a, fig2, ncol = 1, rel_heights = c(.05, 1))
# save plot
ggsave(fig2, file="./plots/fig2.png", dpi = 800,
width = 42, height = 22, units = "cm")
tab2 <- fread("./output_tables/tab2.csv")
# edit text breaks for plot
tab2[ value== "Non-metropolitan area", value := "Non-metropolitan\narea"]
tab2[ value== "Belo Horizonte", value := "Belo\nHorizonte"]
tab2[ value== "Porto Alegre", value := "Porto\nAlegre"]
tab2[ value== "Federal District", value := "Federal\nDistrict"]
tab2[ value== "Rio de Janeiro", value := "Rio\nde Janeiro"]
tab2[ value== "Sao Paulo", value := "Sao\nPaulo"]
# Reorder values and labels
tab2$value <- reorder(tab2$value, tab2$Proportion) # reorder factor levels by poportion values
# change order or plot facets
tab2[, var := factor(var, levels=c( "Total", "Urban", "Region", "Metropolitan Area"))]
tab2[, year := factor(year, levels=c( 2008, 2013))]
plot2a <-
ggplot(data=subset(tab2, var %in% c("Total", "Urban")) ) +
geom_point( aes(x=as.factor(year), y=Proportion, color=quintileBR, fill=quintileBR), size=3, shape=21 ) +
geom_errorbar( aes(x=as.factor(year), y=Proportion, ymin=ci_u, ymax=ci_l, color=quintileBR),  size=0.5, width = 0) +
facet_grid( .~var+value , scales = "free_x", space="free", labeller = label_bquote(cols = .(value) ))  +
baseplot +
scale_colour_grey( start = 0, end = 0.8, guide = guide_legend(title = NULL)) +
scale_fill_grey( start = 0, end = 0.8, guide = guide_legend(title = NULL)) +
# colored chart
# scale_colour_brewer(palette = "Greys") + scale_fill_brewer(palette = "Greys")
# scale_fill_viridis(discrete=T) +  scale_color_viridis(discrete=T)
# scale_fill_manual(values = wes_palette("Royal1"), guide = guide_legend(title = NULL)) +
# scale_color_manual(values = wes_palette("Royal1"), guide = guide_legend(title = NULL)) +
scale_y_continuous(labels = scales::percent, limits=c(0,1)) +
theme(axis.title.x  = element_blank()) +
theme(legend.position = "top") +
theme(plot.margin = unit(c(1,1,2,1), "cm"))
plot2b <-
ggplot(data=subset(tab2, var %in% c("Region")) ) +
geom_point( aes(x=as.factor(year), y=Proportion, color=quintileBR, fill=quintileBR), size=3, shape=21 ) +
geom_errorbar( aes(x=as.factor(year), y=Proportion, ymin=ci_u, ymax=ci_l, color=quintileBR),  size=0.5, width = 0) +
facet_grid( .~var+value , scales = "free_y", space="free", labeller = label_bquote(cols = .(value) ))  +
baseplot +
scale_colour_grey( start = 0, end = 0.8, guide = guide_legend(title = NULL)) +
scale_fill_grey( start = 0, end = 0.8, guide = guide_legend(title = NULL)) +
scale_y_continuous(labels = scales::percent, limits=c(0,1)) +
theme(axis.title.x  = element_blank()) +
theme(axis.title.y  = element_blank()) +
theme(legend.position = "top") +
theme(plot.margin = unit(c(1,1,2,1), "cm"))
plot2c <-
ggplot(data=subset(tab2, var %in% c("Metropolitan Area")) ) +
geom_point( aes(x=as.factor(year), y=Proportion, color=quintileBR, fill=quintileBR), size=3, shape=21 ) +
geom_errorbar( aes(x=as.factor(year), y=Proportion, ymin=ci_u, ymax=ci_l, color=quintileBR),  size=0.5, width = 0) +
facet_grid( .~var+value , scales = "free_y", space="free", labeller = label_bquote(cols = .(value) ))  +
baseplot +
scale_colour_grey( start = 0, end = 0.8, guide = guide_legend(title = NULL)) +
scale_fill_grey( start = 0, end = 0.8, guide = guide_legend(title = NULL)) +
scale_y_continuous(labels = scales::percent, limits=c(0,1)) +
theme(axis.title.x  = element_blank()) +
theme(legend.position = "top") +
theme(plot.margin = unit(c(1,1,2,1), "cm")) +
theme(legend.position="none")
plot2a <- ggdraw(plot2a) +
draw_plot_label("A", size = 14, hjust = -4) +
draw_label("Country",  x = 0.5, y = .075,
size = 14, fontface = 'bold')
plot2b <- ggdraw(plot2b) +
draw_plot_label("B", size = 14, hjust = -4) +
draw_label("Region",  x = 0.5, y = .075,
size = 14, fontface = 'bold')
plot2c <- ggdraw(plot2c) +
draw_plot_label("C", size = 14, hjust = -4) +
draw_label("Metropolitan Area",  x = 0.5, y = .075,
size = 14, fontface = 'bold')
tab2 <- fread("./output_tables/tab2.csv")
tab2[ value== "Non-metropolitan area", value := "Non-metropolitan\narea"]
tab2[ value== "Belo Horizonte", value := "Belo\nHorizonte"]
tab2[ value== "Porto Alegre", value := "Porto\nAlegre"]
tab2[ value== "Federal District", value := "Federal\nDistrict"]
tab2[ value== "Rio de Janeiro", value := "Rio\nde Janeiro"]
tab2[ value== "Sao Paulo", value := "Sao\nPaulo"]
tab2$value <- reorder(tab2$value, tab2$Proportion) # reorder factor levels by poportion values
tab2[, var := factor(var, levels=c( "Total", "Urban", "Region", "Metropolitan Area"))]
tab2[, year := factor(year, levels=c( 2008, 2013))]
plot2a <-
ggplot(data=subset(tab2, var %in% c("Total", "Urban")) ) +
geom_point( aes(x=as.factor(year), y=Proportion, color=quintileBR, fill=quintileBR), size=3, shape=21 ) +
geom_errorbar( aes(x=as.factor(year), y=Proportion, ymin=ci_u, ymax=ci_l, color=quintileBR),  size=0.5, width = 0) +
facet_grid( .~var+value , scales = "free_x", space="free", labeller = label_bquote(cols = .(value) ))  +
baseplot +
scale_colour_grey( start = 0, end = 0.8, guide = guide_legend(title = NULL)) +
scale_fill_grey( start = 0, end = 0.8, guide = guide_legend(title = NULL)) +
# colored chart
# scale_colour_brewer(palette = "Greys") + scale_fill_brewer(palette = "Greys")
# scale_fill_viridis(discrete=T) +  scale_color_viridis(discrete=T)
# scale_fill_manual(values = wes_palette("Royal1"), guide = guide_legend(title = NULL)) +
# scale_color_manual(values = wes_palette("Royal1"), guide = guide_legend(title = NULL)) +
scale_y_continuous(labels = scales::percent, limits=c(0,1)) +
theme(axis.title.x  = element_blank()) +
theme(legend.position = "top") +
theme(plot.margin = unit(c(1,1,2,1), "cm"))
######################!!!!!! RESULTS   RESULTS  RESULTS ######################
# Create Basic Aesthetic stantard for the plots
baseplot <- theme_minimal() +
theme(
axis.text  = element_text(face="bold"),
strip.text = element_text(size = 11, face ="bold"),
legend.text = element_text(size = 11)
)
tab2 <- fread("./output_tables/tab2.csv")
# edit text breaks for plot
tab2[ value== "Non-metropolitan area", value := "Non-metropolitan\narea"]
tab2[ value== "Belo Horizonte", value := "Belo\nHorizonte"]
tab2[ value== "Porto Alegre", value := "Porto\nAlegre"]
tab2[ value== "Federal District", value := "Federal\nDistrict"]
tab2[ value== "Rio de Janeiro", value := "Rio\nde Janeiro"]
tab2[ value== "Sao Paulo", value := "Sao\nPaulo"]
# Reorder values and labels
tab2$value <- reorder(tab2$value, tab2$Proportion) # reorder factor levels by poportion values
# change order or plot facets
tab2[, var := factor(var, levels=c( "Total", "Urban", "Region", "Metropolitan Area"))]
tab2[, year := factor(year, levels=c( 2008, 2013))]
plot2a <-
ggplot(data=subset(tab2, var %in% c("Total", "Urban")) ) +
geom_point( aes(x=as.factor(year), y=Proportion, color=quintileBR, fill=quintileBR), size=3, shape=21 ) +
geom_errorbar( aes(x=as.factor(year), y=Proportion, ymin=ci_u, ymax=ci_l, color=quintileBR),  size=0.5, width = 0) +
facet_grid( .~var+value , scales = "free_x", space="free", labeller = label_bquote(cols = .(value) ))  +
baseplot +
scale_colour_grey( start = 0, end = 0.8, guide = guide_legend(title = NULL)) +
scale_fill_grey( start = 0, end = 0.8, guide = guide_legend(title = NULL)) +
# colored chart
# scale_colour_brewer(palette = "Greys") + scale_fill_brewer(palette = "Greys")
# scale_fill_viridis(discrete=T) +  scale_color_viridis(discrete=T)
# scale_fill_manual(values = wes_palette("Royal1"), guide = guide_legend(title = NULL)) +
# scale_color_manual(values = wes_palette("Royal1"), guide = guide_legend(title = NULL)) +
scale_y_continuous(labels = scales::percent, limits=c(0,1)) +
theme(axis.title.x  = element_blank()) +
theme(legend.position = "top") +
theme(plot.margin = unit(c(1,1,2,1), "cm"))
plot2b <-
ggplot(data=subset(tab2, var %in% c("Region")) ) +
geom_point( aes(x=as.factor(year), y=Proportion, color=quintileBR, fill=quintileBR), size=3, shape=21 ) +
geom_errorbar( aes(x=as.factor(year), y=Proportion, ymin=ci_u, ymax=ci_l, color=quintileBR),  size=0.5, width = 0) +
facet_grid( .~var+value , scales = "free_y", space="free", labeller = label_bquote(cols = .(value) ))  +
baseplot +
scale_colour_grey( start = 0, end = 0.8, guide = guide_legend(title = NULL)) +
scale_fill_grey( start = 0, end = 0.8, guide = guide_legend(title = NULL)) +
scale_y_continuous(labels = scales::percent, limits=c(0,1)) +
theme(axis.title.x  = element_blank()) +
theme(axis.title.y  = element_blank()) +
theme(legend.position = "top") +
theme(plot.margin = unit(c(1,1,2,1), "cm"))
plot2c <-
ggplot(data=subset(tab2, var %in% c("Metropolitan Area")) ) +
geom_point( aes(x=as.factor(year), y=Proportion, color=quintileBR, fill=quintileBR), size=3, shape=21 ) +
geom_errorbar( aes(x=as.factor(year), y=Proportion, ymin=ci_u, ymax=ci_l, color=quintileBR),  size=0.5, width = 0) +
facet_grid( .~var+value , scales = "free_y", space="free", labeller = label_bquote(cols = .(value) ))  +
baseplot +
scale_colour_grey( start = 0, end = 0.8, guide = guide_legend(title = NULL)) +
scale_fill_grey( start = 0, end = 0.8, guide = guide_legend(title = NULL)) +
scale_y_continuous(labels = scales::percent, limits=c(0,1)) +
theme(axis.title.x  = element_blank()) +
theme(legend.position = "top") +
theme(plot.margin = unit(c(1,1,2,1), "cm")) +
theme(legend.position="none")
plot2a <- ggdraw(plot2a) +
draw_plot_label("A", size = 14, hjust = -4) +
draw_label("Country",  x = 0.5, y = .075,
size = 14, fontface = 'bold')
plot2b <- ggdraw(plot2b) +
draw_plot_label("B", size = 14, hjust = -4) +
draw_label("Region",  x = 0.5, y = .075,
size = 14, fontface = 'bold')
plot2c <- ggdraw(plot2c) +
draw_plot_label("C", size = 14, hjust = -4) +
draw_label("Metropolitan Area",  x = 0.5, y = .075,
size = 14, fontface = 'bold')
# Arrange sub-plots
fig2 <-   plot_grid( arrangeGrob(plot2a + theme(legend.position="none"),
plot2b + theme(legend.position="none"), ncol = 2),
plot2c + theme(legend.position="none"), ncol = 1)
fig2
plot2a <-
ggplot(data=subset(tab2, var %in% c("Total", "Urban")) ) +
geom_point( aes(x=as.factor(year), y=Proportion, color=quintileBR, fill=quintileBR), size=3, shape=21 ) +
geom_errorbar( aes(x=as.factor(year), y=Proportion, ymin=ci_u, ymax=ci_l, color=quintileBR),  size=0.5, width = 0) +
facet_grid( .~var+value , scales = "free_x", space="free", labeller = label_bquote(cols = .(value) ))  +
baseplot +
scale_colour_grey( start = 0, end = 0.8, guide = guide_legend(title = NULL)) +
scale_fill_grey( start = 0, end = 0.8, guide = guide_legend(title = NULL)) +
# colored chart
# scale_colour_brewer(palette = "Greys") + scale_fill_brewer(palette = "Greys")
# scale_fill_viridis(discrete=T) +  scale_color_viridis(discrete=T)
# scale_fill_manual(values = wes_palette("Royal1"), guide = guide_legend(title = NULL)) +
# scale_color_manual(values = wes_palette("Royal1"), guide = guide_legend(title = NULL)) +
scale_y_continuous(labels = scales::percent, limits=c(0,1)) +
theme(axis.title.x  = element_blank()) +
theme(legend.position = "none") +
theme(plot.margin = unit(c(1,1,2,1), "cm"))
plot2b <-
ggplot(data=subset(tab2, var %in% c("Region")) ) +
geom_point( aes(x=as.factor(year), y=Proportion, color=quintileBR, fill=quintileBR), size=3, shape=21 ) +
geom_errorbar( aes(x=as.factor(year), y=Proportion, ymin=ci_u, ymax=ci_l, color=quintileBR),  size=0.5, width = 0) +
facet_grid( .~var+value , scales = "free_y", space="free", labeller = label_bquote(cols = .(value) ))  +
baseplot +
scale_colour_grey( start = 0, end = 0.8, guide = guide_legend(title = NULL)) +
scale_fill_grey( start = 0, end = 0.8, guide = guide_legend(title = NULL)) +
scale_y_continuous(labels = scales::percent, limits=c(0,1)) +
theme(axis.title.x  = element_blank()) +
theme(axis.title.y  = element_blank()) +
theme(legend.position = "none") +
theme(plot.margin = unit(c(1,1,2,1), "cm"))
plot2c <-
ggplot(data=subset(tab2, var %in% c("Metropolitan Area")) ) +
geom_point( aes(x=as.factor(year), y=Proportion, color=quintileBR, fill=quintileBR), size=3, shape=21 ) +
geom_errorbar( aes(x=as.factor(year), y=Proportion, ymin=ci_u, ymax=ci_l, color=quintileBR),  size=0.5, width = 0) +
facet_grid( .~var+value , scales = "free_y", space="free", labeller = label_bquote(cols = .(value) ))  +
baseplot +
scale_colour_grey( start = 0, end = 0.8, guide = guide_legend(title = NULL)) +
scale_fill_grey( start = 0, end = 0.8, guide = guide_legend(title = NULL)) +
scale_y_continuous(labels = scales::percent, limits=c(0,1)) +
theme(axis.title.x  = element_blank()) +
theme(legend.position = "top") +
theme(plot.margin = unit(c(1,1,2,1), "cm")) +
theme(legend.position="none")
plot2a <- ggdraw(plot2a) +
draw_plot_label("A", size = 14, hjust = -4) +
draw_label("Country",  x = 0.5, y = .075,
size = 14, fontface = 'bold')
plot2b <- ggdraw(plot2b) +
draw_plot_label("B", size = 14, hjust = -4) +
draw_label("Region",  x = 0.5, y = .075,
size = 14, fontface = 'bold')
plot2c <- ggdraw(plot2c) +
draw_plot_label("C", size = 14, hjust = -4) +
draw_label("Metropolitan Area",  x = 0.5, y = .075,
size = 14, fontface = 'bold')
fig2 <-   plot_grid( arrangeGrob(plot2a ),
plot2b ), ncol = 2),
plot2c ), ncol = 1)
# Arrange sub-plots
fig2 <-   plot_grid( arrangeGrob(plot2a ,
plot2b , ncol = 2),
plot2c , ncol = 1)
fig2
tab1 <- fread("./output_tables/tab1.csv")
# edit text breaks for plot
tab1[ value== "Uneducated + Incomplete primary school", value := "Uneducated + Incomplete\nprimary school"]
tab1[ value== "Complete high school", value := "Complete\nhigh school"]
tab1[ value== "Complete primary school", value := "Complete\nprimary school"]
# change order or plot facets
tab1[, var := factor(var, levels=c( "Year", "Sex", "Education", "Age", "Active Commute"))]
tab1[, value := factor(value, levels=c("2013", "Women",  "Men"
, "18-24", "25-34", "35-44", "45-54", "55-64", "65+"
, "Uneducated + Incomplete\nprimary school", "Complete\nprimary school", "Complete\nhigh school", "University degree"
, "No", "Yes, part of the journey", "Yes, all the journey"))]
plot1a <-
ggplot(data=subset(tab1, var %in% c("Year", "Sex")) ) +
geom_point( aes(x=value, y=Proportion, color=quintileBR, fill=quintileBR), size=3, shape=21 ) +
geom_errorbar( aes(x=value, y=Proportion, ymin=ci_u, ymax=ci_l, color=quintileBR),  size=0.5, width = 0) +
facet_grid( .~var , scales = "free_x", space="free") +
baseplot +
scale_colour_grey( start = 0, end = 0.8, guide = guide_legend(title = NULL)) +
scale_fill_grey( start = 0, end = 0.8, guide = guide_legend(title = NULL)) +
# colored chart
# scale_colour_brewer(palette = "Greys") + scale_fill_brewer(palette = "Greys")
# scale_fill_viridis(discrete=T) +  scale_color_viridis(discrete=T)
# scale_fill_manual(values = wes_palette("Royal1"), guide = guide_legend(title = NULL)) +
# scale_color_manual(values = wes_palette("Royal1"), guide = guide_legend(title = NULL)) +
scale_y_continuous(labels = scales::percent, limits = c(0, 1)) +
theme(axis.title.x  = element_blank()) +
theme(legend.position = "top")
plot1b <-
ggplot(data=subset(tab1, var %in% c("Age")) ) +
geom_point( aes(x=value, y=Proportion, color=quintileBR, fill=quintileBR), size=3, shape=21 ) +
geom_errorbar( aes(x=value, y=Proportion, ymin=ci_u, ymax=ci_l, color=quintileBR),  size=0.5, width = 0) +
facet_grid( .~var , scales = "free_x", space="free") +
baseplot +
scale_colour_grey( start = 0, end = 0.8, guide = guide_legend(title = NULL)) +
scale_fill_grey( start = 0, end = 0.8, guide = guide_legend(title = NULL)) +
scale_y_continuous(labels = scales::percent, limits = c(0, 1)) +
theme(axis.title.x  = element_blank()) +
theme(axis.title.y  = element_blank()) +
theme(legend.position = "top")
plot1c <-
ggplot(data=subset(tab1, var %in% c("Education")) ) +
geom_point( aes(x=value, y=Proportion, color=quintileBR, fill=quintileBR), size=3, shape=21 ) +
geom_errorbar( aes(x=value, y=Proportion, ymin=ci_u, ymax=ci_l, color=quintileBR),  size=0.5, width = 0) +
facet_grid( .~var , scales = "free_x", space="free") +
baseplot +
scale_colour_grey( start = 0, end = 0.8, guide = guide_legend(title = NULL)) +
scale_fill_grey( start = 0, end = 0.8, guide = guide_legend(title = NULL)) +
scale_y_continuous(labels = scales::percent, limits = c(0, 1)) +
theme(axis.title.x  = element_blank()) +
theme(legend.position = "top") +
theme(legend.position="none")
plot1d <-
ggplot(data=subset(tab1, var %in% c("Active Commute")) ) +
geom_point( aes(x=value, y=Proportion, color=quintileBR, fill=quintileBR), size=3, shape=21 ) +
geom_errorbar( aes(x=value, y=Proportion, ymin=ci_u, ymax=ci_l, color=quintileBR),  size=0.5, width = 0) +
facet_grid( .~var , scales = "free_x", space="free") +
baseplot +
scale_colour_grey( start = 0, end = 0.8, guide = guide_legend(title = NULL)) +
scale_fill_grey( start = 0, end = 0.8, guide = guide_legend(title = NULL)) +
scale_y_continuous(labels = scales::percent, limits = c(0, 1)) +
theme(axis.title.x  = element_blank()) +
theme(axis.title.y  = element_blank()) +
theme(legend.position = "top")  +
theme(legend.position="none")
# Arrange sub-plots  adding two empty plots to increasing the space between plots
fig1 <-   plot_grid( plot1a + theme(legend.position="none"),
plot1b + theme(legend.position="none"),
NULL, NULL,
plot1c + theme(legend.position="none"),
plot1d + theme(legend.position="none"),
align = 'vh',
labels=c('A', 'B','','','C',"D"),
hjust = -1,
nrow = 3, rel_heights = c(1, 0.1, 1))
# create separate legend
legend_1a <- get_legend(plot1a + theme(legend.position="top", legend.key.width=unit(3,"line")))
fig2 <- plot_grid( legend_1a, fig2, ncol = 1, rel_heights = c(.05, 1))
fig2
# save plot
ggsave(fig2, file="./plots/fig2.png", dpi = 800,
width = 42, height = 22, units = "cm")
